<% if @test.complete %>
  <div class="card text-center mb-4">
    <div class="card-header">
      <h3>IJE Import Test Results (Test ID: <%= @test.id %>)</h3>
    </div>
    <div class="card-block">
      <h4 class="card-title"><%= @test.successes['successes'].count %> out of <%= @test.successes['successes'].count + @test.problems['problems'].count %> data elements reported successfully.</h2></h4>
      <div class="container-fluid">
        <div class="row justify-content-center p-3">
          <div class="no-pad-no-marg c100 large canary-color p<%= @test.score %>">
              <span><%= @test.score %>%</span>
              <div class="slice">
                <div class="bar"></div>
                <div class="fill"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    <div class="card-footer text-muted">
      Completed <%= time_ago_in_words(@test.updated_at) %> ago.
    </div>
  </div>
  <div id="accordion" role="tablist" aria-multiselectable="true" class="container-fluid no-pad-no-marg">
    <% @test.problems['problems'].each do |problem| %>
      <div id="<%= problem['id'] %>" data-toggle="collapse" data-target="#collapse<%= problem['id'] %>" aria-expanded="true" aria-controls="collapse<%= problem['id'] %>" class="alert alert-danger alert-dismissible fade show">
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <h5><i class="fa fa-times text-danger" aria-hidden="true"></i><span class="pl-2"><%= problem['description'] %></span></h5>
        Expected to find <strong><%= problem['test_value'] %></strong> but instead found <strong><%= problem['uploaded_value'] %></strong>.
      </div>
    <% end %>
    <% @test.successes['successes'].each do |success| %>
      <div id="<%= success['id'] %>" data-toggle="collapse" data-target="#collapse<%= success['id'] %>" aria-expanded="true" aria-controls="collapse<%= success['id'] %>" class="alert alert-success alert-dismissible fade show">
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <h5><i class="fa fa-check text-success" aria-hidden="true"></i><span class="pl-2"><%= success['description'] %></span></h5>
        Found expected value of <strong><%= success['test_value'] %></strong>.
      </div>
    <% end %>
  </div>
  <div class="pb-4"></div>
<% else %>
  <h4 class="mt-3 mb-3">Enter the fields below into the system. When complete, export the record in IJE format, and upload it. Canary will inspect it for correctness and report the results.</h4>
  <%= form_tag({action: :upload, test_type: @type, system_id: params['system_id']}, multipart: true) do |f| %>
    <%= file_field_tag 'ije' %>
    <%= submit_tag "Upload", class: "btn btn-primary" %>
  <% end %>
  <div class="mb-5"></div>
  <% @test.data.each do |key, value| %>
    <strong><%= value['description'] %></strong><br />
    <%= value['value'] %>
    <% if value.key? 'result' %>
      <% if value['result'] %>
        <i class="fa fa-check text-success" aria-hidden="true"></i>
      <% else %>
        <i class="fa fa-times text-danger" aria-hidden="true"></i>
      <% end %>
    <% end %>
    <br /><br />
  <% end %>
<% end %>
